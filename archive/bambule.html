<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Babo Bus Game</title>
	<style type="text/css" media="screen">
		canvas { width: 100%; height: 100%; margin: 0px; }
	</style>
</head>
<body>
	<canvas id="gc" ></canvas>
	<div style="display: none;">
		<img id="sky" src="pictures/background_sky.png"></img>
		<img id="babo1" src="pictures/babo_1.png" ></img>
		<img id="babo2" src="pictures/babo_2.png"></img>
		<img id="babo3" src="pictures/babo_3.png"></img>
		<img id="bg" src="pictures/background2.png"></img>
	</div>
	
	<script>	
	// define vars
	var clickX = 0,
	 clickY = 0,
	 babo1Velocity = 1,
	 babo2Velocity = 1,
	 babo3Velocity = 1,
	 goBabo2 = false,
	 goBabo3 = false,
	 klickBabo = Array(true, true, true),
	 babo1X = 30,
	 babo1Y = 75,
	 babo2X = 120,
	 babo2Y = 75,
	 babo3X = 200,
	 babo3Y = 75,
	 baboSize = 50,
	 appeared = Array(0, 0, 0),
	 score = Array(0, 0, 0),
	 missed = 0,
	 stopped = false,
	 lost = false,
	 game,
	 speed;
	 
	// Load game
	window.onload = function () {
	 canvasObj = document.getElementById('gc'),
	 canvasArea = canvasObj.getContext("2d");
	 speed = setInterval(function() {							// set speed higher every 15 seconds
		babo1Velocity = Math.abs(babo1Velocity) + 1;
		babo2Velocity = Math.abs(babo2Velocity) + 1;
		babo3Velocity = Math.abs(babo3Velocity) + 1;}, 15 * 1000);
	 game = setInterval(update,1000/30);
	 canvasObj.addEventListener("click",function(e) {  
		var rect = canvasObj.getBoundingClientRect();	// abs. size of element
		var scaleX = canvasObj.width / rect.width;		// relationship bitmap vs. element for X
		var scaleY = canvasObj.height / rect.height;	// relationship bitmap vs. element for Y
		clickX = (e.clientX - rect.left) * scaleX;		// scale mouse coordinates after they have
		clickY = (e.clientY - rect.top) * scaleY;		// been adjusted to be relative to element
		
		if (clickX >= 10 && clickX <= 23 && clickY >= 130 && clickY <= 140) {		// Pause function
			stop();
		}
		hit();
	 });
	}
	
	// stop game
	function stop() {
		if ( stopped == false ) {
			stopped = true;
			clearInterval(game);
			
			canvasArea.fillStyle = 'red';
			canvasArea.fillRect(10, 130, 5, 10);
			canvasArea.fillRect(18, 130, 5, 10);
		} else {
			stopped = false;
			game = setInterval(update,1000/30);
		}
		
		if ( lost == true ) {
			stopped = true;
			clearInterval(game);
			
			canvasArea.fillStyle = 'red';
			canvasArea.fillText("Game Over", 10, 15);
			reset();
		}
		
	}

	// Reset game
	function reset() {
		alert("Game Over");
		
	}
	
	//check if babo is hit
	function hit() {
		if(klickBabo[0] == true) {
			if (clickX >= babo1X && clickX <= babo1X + baboSize && clickY >= babo1Y && clickY<= babo1Y + (baboSize - (babo1Y - 5))) {
				score[0]++;
				klickBabo[0] = false;
			}
		}
		if (klickBabo[1] == true) {
			if (clickX >= babo2X && clickX <= babo2X + baboSize && clickY >= babo2Y && clickY<= babo2Y + (baboSize - (babo2Y))) {
				score[1]++;
				klickBabo[1] = false;
			}
		}
		if (klickBabo[2] == true) {
			if (clickX >= babo3X && clickX <= babo3X + baboSize && clickY >= babo3Y && clickY<= babo3Y + (baboSize - (babo3Y - 3))) {
				score[2]++;
				klickBabo[2] = false;
			}
		}
	}
	
	// Updates game
	function update() {
	 // moving 
	 babo1Y += babo1Velocity;
	 if (goBabo2) babo2Y += babo2Velocity;
	 if (goBabo3) babo3Y += babo3Velocity;
	 
	 //change direction
	  if(babo1Y < 10) {
		goBabo2 = true;
		appeared[0]++;
		babo1Velocity = -babo1Velocity;
	  }
	  
	  if(babo1Y > 80) {
		if ( appeared[0] > score[0] ) {
			lost = true;
			stop();
		}
		else {
			klickBabo[0] = true;
			babo1Velocity = -babo1Velocity;
		}
	  }
	  
	  if(babo2Y < 10) {
		goBabo3 = true;
	   appeared[1]++;
	   babo2Velocity = -babo2Velocity;
	  }
	  
	  if(babo2Y > 80) {
		if ( appeared[1] > score[1] ) {
			lost = true;
			stop();
		}
		else {
			klickBabo[1] = true;
			babo2Velocity = -babo2Velocity;
		}
	  }
	  
	  if(babo3Y < 10) {
	   appeared[2]++;
	   babo3Velocity = -babo3Velocity;
	  }
	  
	  if(babo3Y > 80) {
		if ( appeared[2] > score[2] ) {
			lost = true;
			stop();
		}
		else {
			klickBabo[2] = true;
			babo3Velocity = -babo3Velocity;
		}
	  }
	  
	 // draw everything
	 canvasArea.drawImage(document.getElementById('sky'), 0, 0, canvasObj.width, canvasObj.height );
	 canvasArea.drawImage(document.getElementById('babo1'), babo1X, babo1Y, baboSize, baboSize );
	 canvasArea.drawImage(document.getElementById('babo2'), babo2X, babo2Y, baboSize, baboSize );
	 canvasArea.drawImage(document.getElementById('babo3'), babo3X, babo3Y, baboSize, baboSize );
	 canvasArea.drawImage(document.getElementById('bg'), 0, 0, canvasObj.width, canvasObj.height );
	 canvasArea.fillStyle = 'white';
	 canvasArea.fillRect(10, 130, 5, 10);
	 canvasArea.fillRect(18, 130, 5, 10);
	 canvasArea.fillStyle = 'blue';
	 canvasArea.fillText(score[0] + score[1] + score[2], 10, 15);
	 //canvasArea.fillText(appeared[0] + appeared[1] + appeared[2], 10, 25);
	};
	</script>
</body>
</html>